{% extends "base.html" %}

{% block head %}
    {% if experiment.status == 'running' %}
        <meta http-equiv="refresh" content="5">
    {% endif %}
    {% if experiment.status == 'waiting' %}
        <meta http-equiv="refresh" content="60">
    {% endif %}
    
{% endblock %}

{% block content %}
    <h1>Experiment {{ experiment.key }}</h1>

    {% if experiment.status == 'running' %}
        <button onclick='stopExperiment( "{{ experiment.key }}" )' type="button" class="btn btn-danger"> Stop </button>
    {% else %}
        <button onclick='deleteExperiment( "{{ experiment.key }}" )' type="button" class="btn btn-danger"> Delete </button>
    {% endif %}

    {% if experiment.project %}
        <p>Project: {{ experiment.project }}</p>
    {% endif %}
    <p>Filename: {{ experiment.filename }}</p>
    <p>Args: {{ experiment.args }}</p>
    <p>Dependencies:</p>
    <pre>
    {{ experiment.pythonenv }}
    </pre>
    <dl>
    <dt> Experiment artifacts: </dt>
    {% for key,value in artifacts.iteritems() %}
        <dd><a href={{ value }}> {{ key }} </a></dd>
    {% endfor %} 
    <dt><a href='/tensorboard_exp/{{ experiment.key }}'> View in tensorboard </a></dt>
    <dt> Experiment info: </dt>
    <dd>Status: {{ experiment.status }}</dd>
    <dd>Creation time: {{ experiment.time_added | format_time }}</dd>
    {% if experiment.status == 'finished' or experiment.status == 'running' %}
        <dd>Start time: {{ experiment.time_started | format_time }}</dd>
    {% endif %}
    {% if experiment.status == 'finished' %}
        <dd>Finish time: {{ experiment.time_finished | format_time }}</dd>
    {% endif %}
    
    {% if experiment.git %}
        <dd>
        Git repo: <a href={{ experiment.git['url'] }}> {{ experiment.git['url'] }}</a>
            {% if experiment.git['url'].startswith('https://github.com') %}
                <a href={{ experiment.git['url']+'/commit/'+ experiment.git['commit'] }}>
                    commit {{ experiment.git['commit'] }}
                </a>
            {% elif experiment.git['url'].startswith('http://github.com') %}
                <a href={{ experiment.git['url']+'/commit/'+ experiment.git['commit'] }}>
                    commit {{ experiment.git['commit'] }}
                </a>
            {% elif experiment.git['url'].startswith('http://stash.') %}
                <a href={{ experiment.git['url']+'/commits/'+ experiment.git['commit'] }}>
                    commit {{ experiment.git['commit'] }}
                </a>
            {% else %}
                    commit {{ experiment.git['commit'] }}
            {% endif %}
        </dd>
    {% endif %} 

    {% if info %}
        {% if 'type' in info.keys() %}
            {% for infokey, infovalue in info.iteritems() %}
                {% if not infokey == 'logtail' %}
                    <dd>{{ infokey }} : {{ infovalue }}</dd>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endif %}

    {% if logtail %}
        <dt> Tail of the log: </dt>
        {% for line in logtail %}
            <dd>{{ line }}</dd>
        {% endfor %}
    {% endif %}
    </dl>
    

    <script>
        function deleteExperiment(key) {
            if (confirm("The experiment and its artfacts will be lost. Proceed?")) {
                window.location.href = "/delete_experiment/" + key
            }
        }

        function stopExperiment(key) {
            if (confirm("The experiment will be sent a stop signal. Proceed?")) {
                window.location.href = "/stop_experiment/" + key
            }
        }
    </script>

{% endblock %}



